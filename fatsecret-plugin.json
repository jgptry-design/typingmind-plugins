{
  "name": "FatSecret Food Search",
  "description": "Search FatSecret's food database and retrieve nutritional information using OAuth 1.0 authentication",
  "method": "POST",
  "endpoint": "https://platform.fatsecret.com/rest/server.api",
  "headers": {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  "body": {
    "method": "foods.search.v4",
    "search_expression": "{search_query}",
    "format": "json"
  },
  "bodyFormat": "form-data",
  "userSettings": [
    {
      "name": "fatsecret_consumer_key",
      "type": "password",
      "label": "FatSecret Consumer Key",
      "required": true,
      "description": "Your FatSecret API Consumer Key from https://platform.fatsecret.com/"
    },
    {
      "name": "fatsecret_consumer_secret",
      "type": "password",
      "label": "FatSecret Consumer Secret",
      "required": true,
      "description": "Your FatSecret API Consumer Secret from https://platform.fatsecret.com/"
    }
  ],
  "openAIFunctionSpec": {
    "name": "fatsecret_food_search",
    "description": "Search FatSecret's food database for nutritional information. Returns food items with calories, macronutrients, and serving sizes.",
    "parameters": {
      "type": "object",
      "required": ["search_query"],
      "properties": {
        "search_query": {
          "type": "string",
          "description": "Food name to search (e.g., 'chicken breast', 'brown rice', 'olive oil')"
        },
        "max_results": {
          "type": "number",
          "description": "Maximum number of results to return (default: 10, max: 50)",
          "default": 10
        }
      }
    }
  },
  "javascriptImplementation": {
    "code": "async function fatsecret_food_search(params, userSettings) {\n  const crypto = require('crypto');\n  \n  const consumerKey = userSettings?.fatsecret_consumer_key;\n  const consumerSecret = userSettings?.fatsecret_consumer_secret;\n  const searchQuery = params?.search_query;\n  const maxResults = params?.max_results || 10;\n\n  if (!consumerKey || !consumerSecret) {\n    return {\n      status: \"error\",\n      message: \"FatSecret credentials not configured. Please add Consumer Key and Consumer Secret in plugin settings.\"\n    };\n  }\n\n  if (!searchQuery) {\n    return {\n      status: \"error\",\n      message: \"Search query is required\"\n    };\n  }\n\n  try {\n    // OAuth 1.0 signature generation\n    const timestamp = Math.floor(Date.now() / 1000).toString();\n    const nonce = Math.random().toString(36).substring(2, 15);\n    \n    const oauthParams = {\n      oauth_consumer_key: consumerKey,\n      oauth_nonce: nonce,\n      oauth_signature_method: \"HMAC-SHA1\",\n      oauth_timestamp: timestamp,\n      oauth_version: \"1.0\"\n    };\n\n    const requestParams = {\n      method: \"foods.search.v4\",\n      search_expression: searchQuery,\n      page_number: \"0\",\n      max_results: maxResults.toString(),\n      format: \"json\"\n    };\n\n    // Combine all parameters for signature\n    const allParams = { ...oauthParams, ...requestParams };\n    const sortedParams = Object.keys(allParams)\n      .sort()\n      .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(allParams[key])}`)\n      .join(\"&\");\n\n    // Create signature base string\n    const baseString = [\n      \"POST\",\n      encodeURIComponent(\"https://platform.fatsecret.com/rest/server.api\"),\n      encodeURIComponent(sortedParams)\n    ].join(\"&\");\n\n    // Create signing key\n    const signingKey = `${encodeURIComponent(consumerSecret)}&`;\n\n    // Generate HMAC-SHA1 signature\n    const signature = crypto\n      .createHmac(\"sha1\", signingKey)\n      .update(baseString)\n      .digest(\"base64\");\n\n    // Build OAuth header\n    const oauthHeader = \"OAuth \" + Object.keys(oauthParams)\n      .map(key => `${key}=\"${encodeURIComponent(oauthParams[key])}\"`)\n      .concat(`oauth_signature=\"${encodeURIComponent(signature)}\"`)\n      .join(\", \");\n\n    // Build request body\n    const bodyParams = new URLSearchParams();\n    Object.entries(requestParams).forEach(([key, value]) => {\n      bodyParams.append(key, value);\n    });\n\n    // Make API request\n    const response = await fetch(\"https://platform.fatsecret.com/rest/server.api\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": oauthHeader,\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n      },\n      body: bodyParams.toString()\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      return {\n        status: \"error\",\n        code: response.status,\n        message: `FatSecret API error: ${response.statusText}`,\n        details: errorText\n      };\n    }\n\n    const data = await response.json();\n\n    // Parse response\n    if (data.error) {\n      return {\n        status: \"error\",\n        message: data.error.message || \"FatSecret API returned an error\"\n      };\n    }\n\n    // Format results\n    const foods = data.foods?.food || [];\n    const formattedResults = foods.map(food => ({\n      id: food.food_id,\n      name: food.food_name,\n      brand: food.brand_name || \"Generic\",\n      servingSize: food.serving_size?.serving_description || \"Not specified\",\n      calories: food.serving_size?.calories || \"N/A\",\n      protein: food.serving_size?.protein || \"N/A\",\n      carbs: food.serving_size?.carbohydrate || \"N/A\",\n      fat: food.serving_size?.fat || \"N/A\",\n      fiber: food.serving_size?.fiber || \"N/A\"\n    }));\n\n    return {\n      status: \"success\",\n      query: searchQuery,\n      results_count: formattedResults.length,\n      results: formattedResults,\n      note: \"Nutritional values are per serving size listed. Free plan uses US food database.\"\n    };\n\n  } catch (error) {\n    return {\n      status: \"error\",\n      message: \"Failed to search FatSecret\",\n      details: error.message\n    };\n  }\n}"
  },
  "availableVariables": [
    "search_query",
    "max_results"
  ],
  "authentication": "OAuth 1.0",
  "permissions": [
    "read_user_message"
  ],
  "outputOption": "Give output to the AI",
  "context": "Nutrition and food database search"
}
