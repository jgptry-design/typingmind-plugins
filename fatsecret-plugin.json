{
  "name": "FatSecret Food Search",
  "description": "Search FatSecret's food database and retrieve nutritional information",
  "type": "javascript",
  "method": "POST",
  "endpoint": "https://platform.fatsecret.com/rest/server.api",
  "headers": {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  "userSettings": [
    {
      "name": "fatsecret_consumer_key",
      "type": "password",
      "label": "FatSecret Consumer Key",
      "required": true
    },
    {
      "name": "fatsecret_consumer_secret",
      "type": "password",
      "label": "FatSecret Consumer Secret",
      "required": true
    }
  ],
  "functions": [
    {
      "name": "fatsecret_food_search",
      "description": "Search FatSecret's food database for nutritional information",
      "parameters": {
        "type": "object",
        "properties": {
          "search_query": {
            "type": "string",
            "description": "Food name to search"
          },
          "max_results": {
            "type": "number",
            "description": "Maximum results (default: 10)",
            "default": 10
          }
        },
        "required": ["search_query"]
      }
    }
  ],
  "code": "async function fatsecret_food_search(params, userSettings) {\n  const crypto = require('crypto');\n  const consumerKey = userSettings?.fatsecret_consumer_key;\n  const consumerSecret = userSettings?.fatsecret_consumer_secret;\n  const searchQuery = params?.search_query;\n  const maxResults = params?.max_results || 10;\n\n  if (!consumerKey || !consumerSecret) {\n    return { status: 'error', message: 'FatSecret credentials not configured' };\n  }\n\n  if (!searchQuery) {\n    return { status: 'error', message: 'Search query is required' };\n  }\n\n  try {\n    const timestamp = Math.floor(Date.now() / 1000).toString();\n    const nonce = Math.random().toString(36).substring(2, 15);\n    \n    const oauthParams = {\n      oauth_consumer_key: consumerKey,\n      oauth_nonce: nonce,\n      oauth_signature_method: 'HMAC-SHA1',\n      oauth_timestamp: timestamp,\n      oauth_version: '1.0'\n    };\n\n    const requestParams = {\n      method: 'foods.search.v4',\n      search_expression: searchQuery,\n      page_number: '0',\n      max_results: maxResults.toString(),\n      format: 'json'\n    };\n\n    const allParams = { ...oauthParams, ...requestParams };\n    const sortedParams = Object.keys(allParams)\n      .sort()\n      .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(allParams[key])}`)\n      .join('&');\n\n    const baseString = [\n      'POST',\n      encodeURIComponent('https://platform.fatsecret.com/rest/server.api'),\n      encodeURIComponent(sortedParams)\n    ].join('&');\n\n    const signingKey = `${encodeURIComponent(consumerSecret)}&`;\n    const signature = crypto.createHmac('sha1', signingKey).update(baseString).digest('base64');\n\n    const oauthHeader = 'OAuth ' + Object.keys(oauthParams)\n      .map(key => `${key}=\"${encodeURIComponent(oauthParams[key])}\"`)\n      .concat(`oauth_signature=\"${encodeURIComponent(signature)}\"`)\n      .join(', ');\n\n    const bodyParams = new URLSearchParams();\n    Object.entries(requestParams).forEach(([key, value]) => bodyParams.append(key, value));\n\n    const response = await fetch('https://platform.fatsecret.com/rest/server.api', {\n      method: 'POST',\n      headers: { 'Authorization': oauthHeader, 'Content-Type': 'application/x-www-form-urlencoded' },\n      body: bodyParams.toString()\n    });\n\n    if (!response.ok) {\n      return { status: 'error', message: `API error: ${response.statusText}` };\n    }\n\n    const data = await response.json();\n    if (data.error) {\n      return { status: 'error', message: data.error.message };\n    }\n\n    const foods = data.foods?.food || [];\n    const results = foods.map(food => ({\n      name: food.food_name,\n      brand: food.brand_name || 'Generic',\n      calories: food.serving_size?.calories || 'N/A',\n      protein: food.serving_size?.protein || 'N/A',\n      carbs: food.serving_size?.carbohydrate || 'N/A',\n      fat: food.serving_size?.fat || 'N/A'\n    }));\n\n    return { status: 'success', query: searchQuery, results_count: results.length, results };\n  } catch (error) {\n    return { status: 'error', message: 'Failed to search FatSecret', details: error.message };\n  }\n}"
}
